# Money Fact - 개발 가이드 및 로직 명세서

이 문서는 **Money Fact (Money Fact Gold Edition)** 어플리케이션을 처음부터 끝까지 똑같이 구현할 수 있도록 모든 기술적 로직과 시스템 구조를 상세하게 설명합니다.

---

## 1. 시스템 구조 개요

Money Fact는 **React Native (Expo)** 기반의 모바일 앱과 **Node.js (Express)** 기반의 서버로 구성된 클라이언트-서버 아키텍처를 가집니다.

*   **동작 원리**: 
    1.  서버가 주기적으로 한국투자증권(KIS) API를 통해 국내 주식 데이터를 수집 및 분석합니다.
    2.  분석된 결과(매집 정황, 연속 매매 등)는 서버 메모리 및 파일 시스템에 저장됩니다.
    3.  모바일 앱은 서버로부터 분석 데이터를 내려받아 사용자에게 시각적으로 보여줍니다.
    4.  클라우드 백업 기능을 통해 사용자의 관심종목과 설정을 서버에 동기화합니다.

---

## 2. 핵심 개발 로직 상세

### 2.1 한국투자증권(KIS) API 연동
*   **인증**: OAuth 2.0 기반 `access_token` 발급 (서버에서 관리하며 5명의 사용자가 공유할 수 있도록 캐싱).
*   **사용 API**:
    *   `FHKST01010400`: 주식 현재가 시세 (실시간 가격 조회)
    *   `FHKST01012200`: 투자자별 매매 동향 (외국인, 기관, 개인 수집)
    *   `CTRP6010R`: 국내주식 전종목 조회 (레이더 스캔용)

### 2.2 수급 연속성 분석 (Streak Analysis)
가장 핵심적인 로직으로, 특정 주체가 몇 거래일 연속으로 매수/매도하는지를 판별합니다.
*   **로직**:
    1.  최근 2~30일치 투자자 매매 데이터를 가져옵니다.
    2.  당일(idx 0)부터 거꾸로 올라가며 매수(+) 또는 매도(-) 부호가 바뀌는 지점 전까지의 개수를 셉니다.
    3.  **Positive Streak**: 외국인이 5일 연속 순매수하면 `fStreak = 5`.
    4.  **Negative Streak**: 기관이 3일 연속 순매도하면 `iStreak = -3`.

### 2.3 수상한 매집(Hidden Accumulation) 포착
주가는 크게 오르지 않는데 거래량과 수급이 집중되는 구간을 찾아냅니다.
*   **판별 조건**:
    1.  `Price Change < 2%`: 주가 변동은 크지 않음 (조용함).
    2.  `Volume > Avg Volume * 1.5`: 거래량은 평소보다 활발함.
    3.  `Investor Net Buy > 0`: 특정 주체(외인/기관)가 순매수 중.
    4.  이 조건이 설정값(예: 3일) 이상 지속될 경우 '매집 정황'으로 분류.

### 2.4 세력 평단가(VWAP) 계산
세력이 평균적으로 얼마에 주식을 샀는지 추정하여 사용자의 진입 시점을 가이드합니다.
*   **동작**:
    1.  최근 3~5거래일의 (종가 * 거래량)의 합계를 구합니다.
    2.  이를 총 거래량의 합계로 나눕니다.
    3.  `VWAP = Sum(Close * Volume) / Sum(Volume)`
    4.  현재가 < VWAP 이면 '세력보다 저렴한 구간'으로 안내합니다.

### 2.5 하이브리드 레이더 스캔 (서버 측)
서버는 20분마다 KOSPI/KOSDAQ 전 종목을 스캔합니다.
*   **효율화**: 모든 종목을 매번 분석하지 않고, 1차적으로 거래량 상위 종목을 추린 뒤 심층 분석을 수행합니다.

---

## 3. 모바일 앱 기능 구현

### 3.1 주요 화면 구성
*   **대시보드**: 전체 시장 심리 온도계(서버 분석 결과 종합), 섹터별 수급 히트맵.
*   **연속매매 리스트**: 실시간으로 폭풍 매수/매도 중인 종목 정렬.
*   **관심종목**: 사용자가 직접 등록한 종목들의 상세 분석 및 VWAP 비교.
*   **설정**: 민감도(3일 연속 등) 조절 및 닉네임 기반 클라우드 백업.

### 3.2 백라운드 작업 (Expo Task Manager)
*   어플이 꺼져 있어도 OS가 주기적으로 수급을 체크하여 알림을 보냅니다.
*   `BackgroundFetch`를 사용하여 장중(09:00~15:30)에만 동작하도록 배터리를 최적화합니다.

---

## 4. 설치 및 빌드 방법

### 4.1 서버 설정
1.  `server/` 폴더에서 `npm install`
2.  `.env` 파일에 KIS API Key, Secret 저장.
3.  `node index.js`로 실행.

### 4.2 모바일 앱 설정
1.  `mobile/` 폴더에서 `npm install`
2.  `src/constants/Config.js`의 `SERVER_URL`을 본인의 서버 주소로 변경.
3.  `npx expo run:android` 또는 `eas build`를 통해 패키징.

---

이 문서를 따라 구현하면 **Money Fact**의 모든 지능형 수급 추적 기능을 완벽하게 재현할 수 있습니다.
